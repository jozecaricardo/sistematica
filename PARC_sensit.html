<!doctype html>
<html lang="br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>parcimônia com moléculas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Sistemática Filogenética e métodos baseados em modelos</a>
        <div class="btn-group">
          <button type="button" class="btn btn-danger">Introdução</button>
          <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="introducao.html">Início</a></li>
            <li><a class="dropdown-item" href="int_objetivos.html">Objetivos</a></li>
            <li><a class="dropdown-item" href="int_ementa.html">Ementa</a></li>
            <li><a class="dropdown-item" href="int_programa.html">Programa</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="int_referencias.html">Referências bibliográficas</a></li>
          </ul>
        </div>
        <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Classificações
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                <li><a class="dropdown-item" href="class_objetivos.html">Objetivos</a></li>
                <li><a class="dropdown-item" href="class_exercicios.html">Para refletir e responder...</a></li>
                <li><a class="dropdown-item" href="class_subordina.html">Preparando uma classificação por subordinação</a></li>
                <li><a class="dropdown-item" href="class_seque.html">Preparando uma classificação por sequenciação</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Sistemática filogenética (Cladística)
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                  <li><a class="dropdown-item" href="PARC_objetivos.html">Objetivos</a></li>
                  <li><a class="dropdown-item" href="#">Morfologia: busca TRADICIONAL pelo TNT</a></li>
                  <li><a class="dropdown-item" href="#">Morfologia: Busca com o uso de "NEW TECHNOLOGY" pelo TNT</a></li>
                  <li><a class="dropdown-item" href="PARC_moleculaTNT.html">DNA e RNA: Busca de árvores pelo TNT</a></li>
                  <li><a class="dropdown-item" href="PARC_bootBremer.html">Índices de suporte (bootstrap e Índice de Bremer) no TNT</a></li>
                  <li><a class="dropdown-item" href="PARC_pesagemImplicita.html">Pesagem implícita (Implied weighting)</a></li>
                  <li><a class="dropdown-item text-wrap" href="PARC_sensit.html">Análise de sensitividade com o uso de diferentes valores de K determinados pela matriz de caracteres</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="PARC_referencias.html">Referências</a></li>
              </ul>
           </li>
           <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Métodos baseados em modelos
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                  <li><a class="dropdown-item" href="MOD_objetivos.html">Objetivos</a></li>
                  <li><a class="dropdown-item text-wrap" href="MOD_alinhamento.html">Alinhamento de sequências</a></li>
                  <li><a class="dropdown-item text-wrap" href="#">Escolha de modelos de evolução molecular no PartitionFinder</a></li>
                  <li><a class="dropdown-item text-wrap" href="#">Busca de árvores no IQTree e índice de suporte (máxima verossimilhança)</a></li>
                  <li><a class="dropdown-item text-wrap" href="#">Preparação dos dados e busca de árvores pelo MrBayes (Bayesianismo)</a></li>
                  <li><a class="dropdown-item text-wrap" href="#">Escolha de melhor modelo com integração termodinâmica e fator de Bayes</a></li>
                  <li><a class="dropdown-item text-wrap" href="#">Bayesianismo e evidência total (matriz com caracteres baseados em morfologia e em sequências de DNA)</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="#">Referências</a></li>
              </ul>
          </li>
          </ul>
        </div>
      </div>
  </nav>

  <!---- Exercícios -->
  <div>
    <p class="fs-2 text-success">First things first</p>
    <ol>
        <li class="fs-4 fw-normal">Crie um diretório de trabalho na raiz do seu computador. Evite muitos subdiretórios.</li>
        <li class="fs-4 fw-normal">Certifique-se que o arquivo executável do TNT e seu material estejam dentro do mesmo subdiretório.</li>
        <li class="fs-4 fw-normal">Certifique-se de copiar e colar as rotinas em arquivos .txt separados, além de salvá-los no mesmo diretório onde o material e o TNT estão.</li>
    </ol>
  </div>

  <div class="accordion" id="accordionExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingOne">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          Parte #1
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
        <div class="accordion-body">
          <strong>Rotina desenvolvida por MIRANDE (2009) para escolher valor da constante <i>K</i>, usando intervalos iguais de ajuste total:</strong>
          <ol>
            <li class="fs-4 fw-normal">Abrir uma janela de comando, entrar no subdiretório de trabalho já criado e digitar<code>./tnt.exe</code> no Windows;</li>
            <li class="fs-4 fw-normal">Copiar a rotina abaixo para um arquivo .txt, salvar no mesmo diretório de trabalho e digitar <code>mxram 2000;</code>;</li>
            <li class="fs-4 fw-normal">Depois <code>proc [NOME-DO-ARQUIVO.tnt];</code> para carregar a sua matriz no TNT;</li>
            <li class="fs-4 fw-normal">Depois <code>hold 99999;</code> para permitir que até 99.999 árvores possam ser mantidas no TNT;</li>
            <li class="fs-4 fw-normal">Finalmente <code>run [NOME DO ARQUIVO.run] 100 25 50 90 7;</code> para as buscas ponderadas com 25 valores de <i>K</i>.</li>
          </ol>
          <div>
            <pre>
                <code>
                    macro=;
                    ts/;
                    xmu: noprvmix;
                    goto = %0 ;

                    /* Variables and argument definition */
                    clb;
                    if ( argnumber == 0 ) 
                        cls;

                    quote 	
                    Enter arguments: If you want to run the script with the default settings use the argument def . 
                    Number of hits                                        (2)
                    Number of distorsion groups                          (11)
                    Minimum value of distortion in a mean character      (50) 
                    Maximum value of distortion in a mean character      (90)
                    Seaching level                                       (7)
                    Be sure that the file out.txt is not open;
                        proc/;
                    end;
                    var: hits grupos distmin distmax lev; 

                    if (eqstring [%1 def ] )  set hits 2; set grupos 11; set distmin 50; set distmax 90; set lev 7;

                    else
                    set hits %1; set grupos %2; set distmin %3; set distmax %4; set lev %5 ;
                    end;

                    var: longmin pasosmin dif pasosmed distref ['grupos'] kref ['grupos'] largo ['grupos'] fits ['grupos'] difspr ['grupos'] nodcons['grupos'] agree ['grupos'] arboles ['grupos'] ;

                    /* Searching with equal weights */
                    /* Determining the number of steps in a "mean" character" */

                    rse 0; coll 3;
                    macreport=;
                    pi-;
                    k0;
                    echo-;
                    report=;
                    ho100;
                    xmu= hits 'hits' level 'lev' drift10;

                    set longmin length [0];  	
                    set pasosmin minsteps;	
                    set dif ('longmin'-'pasosmin');  	

                    set pasosmed ('dif'/'pasosmin');	/* steps of a mean character */

                    loop 0 ('grupos'-1)
                    set distref [#1] ('distmin'+((#1/('grupos'-1))*('distmax'-'distmin')));  
                    stop; 		

                    quote 'distref';

                    loop 0 ('grupos'-1)
                    set kref[#1] ('pasosmed'*('distref[#1]'/100)/(1-('distref[#1]'/100)));
                    stop;             	/* variables 30-40 = k0 a k10 */
                            
                    /* BUSQUEDAS */

                    loop 0 ('grupos'-1)
                        rse0; ho10000;
                        pi='kref[#1]';
                        k1;
                        xmu: prvmix;
                        xmu= hits 'hits' level 'lev' rat10 drift10; 
                        bb;
                        ts k#1..ctf;
                        save;
                        ts/;
                        set largo[#1] length[0];
                        set fits[#1] fit[0];
                    stop;

                    goto AAB;
                    proc/;



                    label AAB 
                    hold 1000;
                    ts cons.ctf;
                    loop 0 ('grupos'-1)
                        k0; sh k#1..ctf; 
                        set arboles[#1] (ntrees+1);
                        ne*; save/;
                    stop;
                    ts/;
                    k0;
                    sh cons.ctf;
                    var: tmp;
                    set difspr[0] 0;
                    loop 1 ('grupos'-1)
                        set tmp ((#1)-1);
                        set difspr [#1] sprdiff [#1 'tmp' 100x200]; 
                    end;
                    stop;
                    set agree[0] 0;
                    set nodcons[0] 0;
                    loop 1 ('grupos'-1)
                        k0;
                        set tmp ((#1)-1);
                        sh k'tmp'.ctf; sh k#1..ctf;
                        prunn!*; tchoose/;
                        set agree[#1] ((tnodes[0])+2);
                        k0;
                        sh k'tmp'.ctf; sh k#1..ctf;
                        ne*; tchoose/; set nodcons[#1] tnodes[0];
                    end;
                    stop;
                    macfloat 3;
                    log/;	/* Just in case...*/
                    macreport-;
                    log out.txt;
                    quote archivo, distref, kref, length, trees, fit, difspr, agree, nodcons;
                    loop 0 ('grupos'-1)
                        quote  k#1, 'distref[#1]', 'kref[#1]', 'largo[#1]', 'arboles[#1]', 'fits[#1]', 'difspr[#1]', 'agree[#1]', 'nodcons[#1]';
                    stop;
                    log/;
                    proc/;
                </code>
            </pre>
            <p class="fw-light font-monospace">Um arquivo .out será produzido. Entretanto, esse arquivo não faz a estimação corretamente porque a rotina não estima as distâncias entre TODAS as possibilidades.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingTwo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
          Parte #2
        </button>
      </h2>
      <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
        <div class="accordion-body">
          <strong>Para uma estimativa correta, use a rotina abaixo. Ela calculará as distâncias SPR entre TODAS as árvores. Não esqueça antes de mudar o endereçamento contido na rotina para o local onde estão os arquivos .ctf produzidos pela rotina anterior. No pipeline de comando, digite <code>run [nome_do_arquivo].txt 24;</code>, onde o número 24 representa o número de intervalos escolhidos menos um.</strong>
          <div>
            <pre>
                <code>
                    macro=;
                    silent- all;
                    /* We developed a routine for the automatic calculation of the SPR distances among all trees produced by an interval of K-values defined by the method of Mirande (2009) in TNT: the calculation of the SPR distance for each of the trees produced is usually laborious and is assumed to produce typing errors because the outcome of the routine usually is converted into triangular matrices! */

                    keep 0; 
                    macro * 15 1000;

                    quote
                    ===========================================================================================
                    Please before run open the routine and specify the directory of your trees in .ctf format!
                    ===========================================================================================
                    ===========================================================================================
                    [1] Number of k values - remember that we start counting from 0 in TNT!: so, n-1!
                    ===========================================================================================
                    ;

                    /* loading the trees in .ctf format */
                    loop 0 %1;
                        short C:/Users/Jose/Desktop/CTNT/k#1..ctf; /* CHANGE THE ADDRESS HERE! */ 
                    stop;
                    var: difspr valor ktotal[(%1+1)] difspr2 difspr3 tota;
                    set valor 0;
                    report=;
                    set difspr 0;
                    set tota 0; 
                    set difspr2 0;
                    set difspr3 0;
                    loop 0 %1;
                        set difspr3 0;
                        loop 0 %1;
                            set difspr2 0;
                            loop 1 200;
                                set difspr sprdiff ['valor' #2 100x#3];
                                set tota += 'difspr';
                            stop;
                        set difspr2 ('tota'/200);
                        set difspr3 += 'difspr2';
                        set tota 0;
                        stop;
                        set ktotal[#1] 'difspr3';
                        set valor ++;
                        set difspr 0;
                        set tota 0;
                    stop;

                    log C:/Users/Jose/Desktop/CTNT/sprresults.out1; /* CHANGE THE ADDRESS HERE! */
                    quote kval, difspr_total;
                    loop 0 %1;
                        quote k#1, 'ktotal[#1]';
                    stop;
                    log/;
                    keep 0;
                    quote Macro designed by J. R. I. Ribeiro (v. 1.2);
                    proc/;
                </code>
            </pre>
            <p class="fw-light font-monospace">Um arquivo sprresults.ou1 será produzido. Esse arquivo possui as distâncias SPR totais entre todas as árvores obtidas da pesagem com o valor de <i>K</i> específico.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingThree">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          Procedimento manual
        </button>
      </h2>
      <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
        <div class="accordion-body">
          <strong>Para uma estimativa correta, há ainda a possibilidade de calcularmos os ajustes e comparamos uns com os outros com o algoritmo descrito na<a href="ImpliedWeightModel.xlsx"> matriz triangular</a> disponível. O roteiro "Jerep" é usado quando não estiver calculando as coisas por rotinas...</strong> 
          <ol>
            <li class="fs-4 fw-normal">Selecionar grupo-externo (lembre-se que o TNT só pode usar um grupo-externo);</li>
            <li class="fs-4 fw-normal"><code>mxram 2000;</code> [aumenta espaço de memória RAM]</li>
            <li class="fs-4 fw-normal"><code>proc NOME_DA_MATRIZ_DE_CARACTERES;</code> [carrega a matriz de caracteres]</li>
            <li class="fs-4 fw-normal"><code>hold 99999;</code> [define buffer de árvores para salvar até <strong>99999</strong> árvores]</li>
            <li class="fs-4 fw-normal"><code>piwe=3;</code> [ajuste do valor de <i>K</i>]</li>
            <li class="fs-4 fw-normal"><code>mult 700 = hold 150 tbr;</code> [busca com 700 RAS, mantendo 150 na memória a cada réplica]</li>
            <li class="fs-4 fw-normal"><code>bb = tbr;</code> [com as árvores retidas na memória, fazer uma busca do tipo <i>tree-bissection-reconnection</i> (tbr)]</li>
            <p></p>
            <p>Se for encontrada mais de uma árvore...</p>
            <li class="fs-4 fw-normal"><code>nelsen*;</code> [calcula consenso estrito, se houver mais de uma árvore]</li>
            <li class="fs-4 fw-normal"><code>tsave *k0.ctf;</code> [abre arquivo de árvore e mantém apenas a última árvore na memória]</li>
            <li class="fs-4 fw-normal"><code>save {strict};</code> [salva a árvore]</li>
            <li class="fs-4 fw-normal"><code>tsave/ ;</code> [fecha o arquivo]</li>
            <li class="fs-4 fw-normal"><code>length {strict};</code> [ver o número de passos (S) da árvore]</li>
            <li class="fs-4 fw-normal"><code>fit {strict};</code> [ver o ajuste da árvore]</li>
            <li class="fs-4 fw-normal"><code>minsteps {strict};</code> [ver o número mínimo de passos (Smin)]</li>
            <li class="fs-4 fw-normal">Calcular o número de passos médios (Sm): Sm = (S - Smin) / Smin. Isso pode ser calculado diretamente no arquivo cedido.</li>
            <li class="fs-4 fw-normal"><code>keep 0;</code> [limpar a memória]</li>
            <li class="fs-4 fw-normal">Repetir o processo até todos os valores de <i>K</i> forem explorados!</li>
            <P></P>
            <li class="fs-4 fw-normal"><code>short k0.ctf;</code> [carrega a árvore consenso estimada com um determinado valor de <i>K</i>];</li>
            <li class="fs-4 fw-normal"><code>short k1.ctf;</code> [carrega a árvore consenso estimada com um determinado valor de <i>K</i>];</li>
            <li class="fs-4 fw-normal"><code>sprdiff [1 0 100x200];</code> [calcula a distância SPR entre as árvores 1 e 0];</li>
            <li class="fs-4 fw-normal">Colocar os valores na <a href="ImpliedWeightModel.xlsx"> matriz triangular</a>;</li>
            <li class="fs-4 fw-normal">Repetir o processo até todos os valores de <i>K</i> forem explorados!</li>
            <li class="fs-4 fw-normal">Achar o valor de <i>K</i> que esteja associado com o <strong>menor valor total de distância SPR encontrada</strong>.</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
  </body>
</html>