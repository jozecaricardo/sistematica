<!doctype html>
<html lang="br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>pesagem implícita</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Sistemática Filogenética e métodos baseados em modelos</a>
        <div class="btn-group">
          <button type="button" class="btn btn-danger">Introdução</button>
          <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="index.html">Início</a></li>
            <li><a class="dropdown-item" href="int_objetivos.html">Objetivos</a></li>
            <li><a class="dropdown-item" href="int_ementa.html">Ementa</a></li>
            <li><a class="dropdown-item" href="int_programa.html">Programa</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="int_referencias.html">Referências bibliográficas</a></li>
          </ul>
        </div>
        <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Classificações
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                <li><a class="dropdown-item" href="class_objetivos.html">Objetivos</a></li>
                <li><a class="dropdown-item" href="class_exercicios.html">Para refletir e responder...</a></li>
                <li><a class="dropdown-item" href="class_subordina.html">Preparando uma classificação por subordinação</a></li>
                <li><a class="dropdown-item" href="class_seque.html">Preparando uma classificação por sequenciação</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Sistemática filogenética (Cladística)
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                  <li><a class="dropdown-item" href="PARC_objetivos.html">Objetivos</a></li>
                  <li><a class="dropdown-item" href="#">Morfologia: busca TRADICIONAL pelo TNT</a></li>
                  <li><a class="dropdown-item" href="#">Morfologia: Busca com o uso de "NEW TECHNOLOGY" pelo TNT</a></li>
                  <li><a class="dropdown-item" href="PARC_moleculaTNT.html">DNA e RNA: Busca de árvores pelo TNT</a></li>
                  <li><a class="dropdown-item" href="PARC_bootBremer.html">Índices de suporte (bootstrap e Índice de Bremer) no TNT</a></li>
                  <li><a class="dropdown-item" href="PARC_pesagemImplicita.html">Pesagem implícita (Implied weighting)</a></li>
                  <li><a class="dropdown-item text-wrap" href="PARC_sensit.html">Análise de sensitividade com o uso de diferentes valores de K determinados pela matriz de caracteres</a></li>
                  <li><a class="dorpdown-item text-wrap" href="PARC_MorfMoleculaTNT.html">Análise de evidência total</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="PARC_referencias.html">Referências</a></li>
              </ul>
           </li>
           <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Métodos baseados em modelos
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                  <li><a class="dropdown-item" href="MOD_objetivos.html">Objetivos</a></li>
                  <li><a class="dropdown-item text-wrap" href="MOD_alinhamento.html">Alinhamento de sequências</a></li>
                  <li><a class="dropdown-item text-wrap" href="MOD_partition.html">Escolha de modelos de evolução molecular no IQ-TREE e melhores esquemas de partição</a></li>
                  <li><a class="dropdown-item text-wrap" href="MOD_verossimil.html">Busca de árvores no IQTree e índice de suporte (máxima verossimilhança)</a></li>
                  <li><a class="dropdown-item text-wrap" href="MOD_bayes.html">Preparação dos dados e busca de árvores pelo MrBayes (Bayesianismo)</a></li>
                  <li><a class="dropdown-item text-wrap" href="#">Escolha de melhor modelo com integração termodinâmica e fator de Bayes</a></li>
                  <li><a class="dropdown-item text-wrap" href="MOD_bayesTotalEvid.html">Bayesianismo e evidência total (matriz com caracteres baseados em morfologia e em sequências de DNA)</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="MOD_referencias.html">Referências</a></li>
              </ul>
          </li>
          </ul>
        </div>
      </div>
  </nav>

  <!---- Exercícios -->
  <div>
    <p class="fs-2 text-success">First things first</p>
    <ol>
        <li class="fs-4 fw-normal">Crie um diretório de trabalho na raiz do seu computador. Evite muitos subdiretórios.</li>
        <li class="fs-4 fw-normal">Após a escolha do modelo de substituição (ou modelos, caso haja mais de uma partição), instale o <a href="https://nbisweden.github.io/MrBayes/download.html">MrBayes</a>. </li>
        <li class="fs-4 fw-normal">Instale também o programa <a href="https://github.com/beast-dev/tracer/releases/tag/v1.7.2">Tracer</a> para a visualização de convergência das cadeias de Markov. </li>        
    </ol>
  </div>

  <p class="fw-semibold fs-6 lh-sm">Criar uma matriz de caracteres com base em dados de morfologia e moleculares para ser lida no MrBayes, com base nas informações contidas em <a href="Clupeidae_combined_Bayes.nex">uma matriz com os dados separados em blocos</a>, de espécies de peixe da família Clupeidae, ou com a <a href="Clupeidae_Morph+COI (datatype=mixed).nex">matriz combinando todos os dados em um único bloco</a>.</p>

  <div class="accordion" id="accordionExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingOne">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          Parte #1
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
        <div class="accordion-body">
            <strong>Tutorial para criar uma matriz de caracteres baseados em morfologia e DNA, a fim de ser lido corretamente pelo MrBayes:</strong>
            <div>
              <pre>
                  <code>
                      #NEXUS
                      [qualquer comentário pode ser colocado entre colchetes, em qualquer perte do código]

                      BEGIN TAXA; [bloco dos táxons]
                        DIMENSIONS NTAX=; [colocar o número de táxons de sua matriz]
                        TAXLABELS [colocar, abaixo, o nome dos táxons, tanto um em cada linha como em bloco]
                        ...
                        ; [importante terminar com ponto-e-vírgula]
                      END;

                      BEGIN CHARACTERS; [bloco dos caracteres]
                        DIMENSIONS NCHAR=; [colocar o número TOTAL de caracteres]
                        FORMAT DATATYPE=mixed(standard: ?-?, dna: ?-?) MISSING=? GAP=- INTERLEAVE;
                        [como alternativa: Format datatype=standard symbols="0123ACGTN" gap=- missing=?;]

                      MATRIX [dados MORFOLÓGICOS misturados às sequências de DNA]
                      nome_do_taxon#1 0001110001CCTTAAGGGGGG
                      ...
                      ;
                      END;

                      BEGIN MRBAYES; [rotina onde fazemos a configuração do MrBayes]
                        SET AUTOCLOSE=YES NOWARN=YES;
                        Ctype unordered:1-...; [unordered characters]
                        CHARSET PART1 = 1-...; [morfologia]

                        CHARSET PART2 = ...-...; [porção de um gene: DNA]
                        [Se for um gene codificante de proteína: lembre-se que precisamos definir o início de leitura 'AUG' e os stop codons 'UAA', 'UAG' etc.
                        charset pos_1 = 1-...\3;
                        charset pos_2 = 2-...\3;
                        charset pos_3 = 3-...\3;]

                        CHARSET PART3 = ...-... ...-... ...-...; [caso sejam vários genes numa partição, após uma análise com o Partiton Finder ou outro programa qualquer]

                        PARTITION ALL=2: PART1, PART2, ...; [agrupe todas as partições com essa linha: '2' significa o número de partiçoes]
                        SET PARTITION=ALL; [ao invés de 'ALL', pode ser qualquer nome, desde que tenhamos definido antes]
                        
                        [start logfile]
                        log start filename="analise_Bayes.txt"; [podemos endereçar para onde quisermos]

                        constraint ingroup = 2-.; [define grupo-interno]
                        [podemos criar um grupo também e dizer ao MrBayes que queremos sempre ele formado:
                        [constrain ingroup: um exemplo...
                        constraint ingroup=
                        Belostoma_parvum
                        Belostoma_micantulum
                        Belostoma_micantulum_var1
                        Belostoma_estevezae
                        Belostoma_lariversi
                        Belostoma_lariversi_var1
                        Belostoma_pygmeum
                        Belostoma_pygmeum_var1
                        Belostoma_nicaeum
                        Belostoma_nicaeum_var1
                        Belostoma_plebejum
                        Belostoma_minusculum
                        Belostoma_minusculum_var1
                        Belostoma_sp1
                        Belostoma_nessimiani
                        Belostoma_sp2
                        ;
                        ########### helps to seep up analysis, reach convergence and correct rooting ############### 
                        prset topologypr=constraints(ingroup);]
                        
                        lset applyto=(1) coding=variable rates=gamma; [Mk+G unordered para MORFOLOGIA e coding = variable significa que temos caracteres com autapomorfias, assim como sinapomorfias]
                        [set hyperprior parameters for rate variation among characters]
                        prset app=(all) shapepr=exponential (1.0); [priori para tirar valores de alfa da distribuição gamma]

                        lset applyto=(2) nst=6 rates=gamma; [GTR+G PARA DNA]
                        [lset applyto=(2) nst=mixed rates=gamma; GTR+G mais geral para modelos de DNA]
                        [lset applyto=(2) nst=mixed rates=Invgamma; GTR+G+I mais geral para modelos de DNA] 
                        [lset applyto=(2) nst=mixed; GTR mais geral para modelos de DNA]

                        [unlink parameters across partitions-applicable to partitioned data only]
                        unlink statefreq=(all) revmat=(all) shape=(all) pinvar=(all) tratio=(all);

                        prset applyto=(all) ratepr=variable; [priori]
                        
                        mcmcp ngen= 1000000 relburnin=yes burninfrac=0.25 printfreq=1000  samplefreq=1000 nruns=2 nchains=4 temp=0.02 savebrlens=yes, startingtree=random;
                        mcmc;
                        sump;
                        sumt contype=halfcompat Outputname=dnaMorfoTree_MRC.t; [podemos endereçar para onde quisermos] 
                      END;
                  </code>
              </pre>
              <p class="fw-light font-monospace">Você deve salvar o arquivo no formato texto, com a extensão <bold>.txt</bold>. Dessa vez, não precisaremos criar uma rotina para ser executada: <strong>ela já está criada dentro da própria matriz! Assim, só o que precisamos fazer é digitar <code>execute ROTINA_MATRIZ.txt</code> dentro do MrBayes.</strong></p>
            </div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
            Código para uma análise Bayesiana (molecular + morfológica) explicado
          </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="collapseTwo" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <strong>Uma análise básica para busca Bayesiana de árvores mais prováveis (hipótese), dado os dados e um modelo de evolução (ou modelos)</strong>.
            <ol>
              <li class="fs-4 fw-normal">Abrir a pasta onde o MrBayes foi descompactado <strong>(/MrBayes-3.2.7-WIN/bin/)</strong> e clicar no executável mb.3.2.7-win32.exe ou mb.3.2.7-win64.exe,
                 dependendo do seu computador; em seguida, copie as linhas abaixo para um arquivo .txt;</li>
              <li class="fs-4 fw-normal"><code>begin mrbayes;</code></li>
              <li class="fs-4 fw-normal"><code>set autoclose=yes nowarn=yes;</code> [fecha o programa depois de terminar]</li>
              <li class="fs-4 fw-normal"><code>log start filename="NOME_DO_ARQUIVO_CONTENDO_OS_RESULTADOS.log";</code> [inicia o arquivo .log]</li>
              <li class="fs-4 fw-normal"><code>constraint ingroup = 2-.;</code> [define o grupo-interno]</li>
              <li class="fs-4 fw-normal"><code>prset topologypr=constraints(ingroup);</code> [ajuda na convergência e corrige o enraizamento]</li>
              <p></p>
              <li class="fs-4 fw-normal"><code>charset PART1 = ?-?;</code> [define a partição #1]</li>
              <li class="fs-4 fw-normal"><code>charset PART2 = ?-?;</code> [define a partição #2]</li>
              <p>Para partições de posições de nucleotídeos dentro dos códons num fragmento de gene que codifica proteína:</p>
              <li class="fs-4 fw-normal"><code>charset pos_1 = 1-...\3;</code> [define a primeira posição dentro do códon]</li>
              <li class="fs-4 fw-normal"><code>charset pos_2 = 2-...\3;</code> [define a segunda posição dentro do códon]</li>
              <li class="fs-4 fw-normal"><code>charset pos_3 = 3-...\3;</code> [define a terceira posição dentro do códon]</li>
              <p>Para a matriz de caracteres baseados em morfologia...</p>
              <li class="fs-4 fw-normal"><code>lset applyto=(1) coding=variable rates=gamma;</code> [Mkv+G, mas se quiser que tudo esteja na mesma taxa, colocar 'rates=equal']</li>
              <p>Para a matriz de caracteres baseados em DNA...</p>
              <li class="fs-4 fw-normal"><code>lset applyto=(2) nst=6 rates=gamma;</code> [GTR+G, mas se quiser GTR+G+I, colocar 'rates=Invgamma']</li>
              <li class="fs-4 fw-normal"><code>lset applyto=(2) nst=mixed rates=gamma;</code> [GTR+G mais geral]</li>
              <p></p>
              <li class="fs-4 fw-normal"><code>prset applyto=(all) ratepr=variable;</code> [ajusta os parâmetros do priori de todas as partições para a variação da taxa de evolução entre caracteres]</li>
              <li class="fs-4 fw-normal"><code>prset applyto=(all) shapepr=exponential (1.0)</code> [ajusta os hiperparâmetros da distribuição exponencial do priori de todas as partições para a taxa de variação entre caracteres]</li>
              <p></p>              
              <li class="fs-4 fw-normal"><code>unlink statefreq=(all) revmat=(all) shape=(all) pinvar=(all) tratio=(all);</code> [desconecta os parâmetros ao longo das partições]</li>
              <p></p>
              <p>Agora, a análise propriamente dita!</p>
              <li class="fs-4 fw-normal"><code>mcmcp ngen=1000000 relburnin=yes burninfrac=0.25 printfreq=1000  samplefreq=1000 nruns=2 nchains=4 nswaps=3 temp=0.02 savebrlens=yes startingtree=random;</code> [parâmetros da análise]</li>
              <li class="fs-4 fw-normal"><code>mcmc;</code> [inicia a análise]</li>
              <li class="fs-4 fw-normal"><code>sump;</code> [sumaria os valores obtidos dos parâmetros]</li>
              <li class="fs-4 fw-normal"><code>sumt contype=halfcompat Outputname=dnaMorfoTree_MRC.t;</code> [resulta em uma árvore de consenso de maioria de 50%]</li>
              <li class="fs-4 fw-normal"><code>log stop;</code> [fecha o arquivo .log]</li>
              <li class="fs-4 fw-normal"><code>end;</code> [finaliza a rotina]</li>             
            </ol>          
            <p></p>
            <p class="fw-light font-monospace">Veja a árvore de consenso de maioria no programa FigTree.</p>
  
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingThree">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            Otimização de caracteres baseados em morfologia na árvore de probabilidade posterior
          </button>
        </h2>
        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <ul>
              <li class="fs-4 fw-normal">Em primeiro lugar, instale o programa <a href="http://www.diversityoflife.org/winclada/">WinClada</a>.</li>
              <li class="fs-4 fw-normal">Há um tutorial em formato <a href="tutorial_winclada_iniesta.pptx">.pptx</a>.</li>
              <li class="fs-4 fw-normal">Precisamos de uma matriz e de uma árvore, <a href="testeWinclada.tre">em geral no formato Hennig86, NONA ou WinClada</a>, em formato .tre para abrir no programa
                 a fim de otimizar os caracteres numa árvore produzida. O arquivo já conterá tudo que precisaremos!</li>
              <li class="fs-4 fw-normal">Para criar esse arquivo, esse formato deve ser produzido no MESQUITE (no caso de árvores sem ou com comprimentos de ramos).
                 Precisamos abrir tanto a matriz como uma árvore de escolha no MESQUITE e salvar conforme a opção necessária (Hennig86, NONA ou WinClada). Essa é a única forma de fazer o WinClada ler o arquivo!</li>
            </ul>
          </div>
        </div>
      </div>   
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingFour">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
          Exercícios
        </button>
      </h2>
      <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionExample">
        <div class="accordion-body">
          <ul>
            <li><p class="fst-italic fs-6">O que acontecerá com a porcentagem de contribuição das cadeias quentes nas frias com a diminuição da temperatura para 0,1, com <code>temp=0.10</code>?</p></li>
            <li><p class="fst-italic fs-6">Como são as árvores de cada partição quando comparadas à árvore com a matriz concatenada?</p></li>
            <li><p class="fst-italic fs-6">Que caracteres são sinapomorfias não-homoplásicas? O que é homoplasia? Que homoplasias foram encontradas?</p></li>
          </ul>
        </div>
      </div>
    </div> 
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
  </body>
</html>